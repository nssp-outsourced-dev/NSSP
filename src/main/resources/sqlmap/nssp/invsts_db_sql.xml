<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="invsts">

	<select id="selectStsZrlongList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.ZRLONG_REQST_NO, A.CASE_NO) AS RN
				</isEmpty>
			FROM
				(
					SELECT
					    A.ZRLONG_REQST_NO,
					    R.ZRLONG_NO,
					    C.CASE_NO,
					    C.RC_NO,
					    A.REQST_DE,
					    FN_CD_NM(NVL(D.RSPOFC_CD, D.CLSF_CD)) || ' ' || D.USER_NM AS REQST_NM,
					    B.TRGTER_NM,
					    DGUARD.DECRYPT('TBL','ENC',B.TRGTER_RRN) AS TRGTER_RRN,
					    FN_CD_NM(B.OCCP_CD) AS OCCP_NM,
					    B.DWLSIT_ADDR,
					    FN_RC_VIOLT_ROOT_NM (A.RC_NO) AS VIOLT_ROOT_NM,
					    DECODE(R.DSMSSL_INSTT_CD, 'P', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) AS P_DSMSSL_INSTT,         /*검찰사-검사*/
					    DECODE(R.DSMSSL_INSTT_CD, 'C', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) AS C_DSMSSL_INSTT,         /*법원-판사*/
					    TO_CHAR(R.ISUE_DT,'YYYY.MM.DD HH24:MI') AS ISUE_DT,
					    CASE WHEN A.REREQST_RESN IS NOT NULL THEN A.REQST_DE END AS RE_REQST_DE,
					    CASE WHEN A.REREQST_RESN IS NOT NULL THEN DECODE(R.DSMSSL_INSTT_CD, 'P', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) END AS RE_P_DSMSSL_INSTT,
					    CASE WHEN A.REREQST_RESN IS NOT NULL THEN DECODE(R.DSMSSL_INSTT_CD, 'C', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) END AS RE_C_DSMSSL_INSTT,
					    CASE WHEN A.REREQST_RESN IS NOT NULL THEN R.ISUE_DT END AS RE_ISUE_DT,
					    TO_CHAR(NVL(R.VALID_DT, A.VALID_DT),'YYYY.MM.DD HH24:MI') AS VALID_DT,
					    TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI') AS EXCUT_DT,
					    R.EXCUT_PLACE,
					    CASE WHEN R.ZRLONG_NO IS NOT NULL AND R.EXCUT_DT IS NOT NULL AND A.ZRLONG_REQST_YN = 'Y' THEN '처리완료' ELSE '' END AS RESULT_YN,
					    /*구속영장신청번호*/
					    /*발부연원일*/
					    TO_CHAR(R.RSL_DT,'YYYY.MM.DD HH24:MI') AS RSL_DT,
					    FN_CD_NM(R.RSL_RESN_CD) || DECODE(R.RSL_RESN_ETC, NULL,'', ' ') || R.RSL_RESN_ETC AS RSL_RESN,
					    /*반환*/
					    /*비고*/
					    A.ARRST_DT,
					    (SELECT CD.CD_DC FROM CMN_CD CD WHERE CD.ESNTL_CD = A.ARSTT_CD ) AS ARSTT_NM,
					    FN_CD_NM(A.ZRLONG_SE_CD) AS ZRLONG_SE_NM,
					    R.DSMSSL_RESN,
					    FN_CD_NM(R.EXCUT_INCPCTY_CD) ||DECODE(R.EXCUT_INCPCTY_ETC, NULL,'', ' ')||R.EXCUT_INCPCTY_ETC AS EXCUT_INCPCTY
					FROM INV_ZRLONG_REQST A
					LEFT JOIN INV_ZRLONG_RESULT R ON A.ZRLONG_NO = R.ZRLONG_NO
					LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
					LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
					LEFT JOIN CMN_USER D ON A.WRITNG_ID = D.ESNTL_ID
					WHERE C.USE_YN = 'Y'
					<isNotEmpty property="zrlong_se_cd" >
						AND A.ZRLONG_SE_CD = #zrlong_se_cd#
					</isNotEmpty>
					<isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND A.REQST_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND A.REQST_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>					
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>
	<select id="selectStsArrstList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
        FROM (
            SELECT A.*,            	
                COUNT(*) OVER() AS TOT_CNT,
                <isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.ARRST_SN, A.CASE_NO) AS RN
				</isEmpty>
            FROM
                (
                    SELECT
                       A.ARRST_SN,
                       C.CASE_NO,
                       C.RC_NO,
                       B.TRGTER_NM,
                       DGUARD.DECRYPT('TBL','ENC',B.TRGTER_RRN) AS TRGTER_RRN,
                       FN_CD_NM(B.OCCP_CD) AS OCCP_NM,
                       B.DWLSIT_ADDR,
                       FN_RC_VIOLT_ROOT_NM (A.RC_NO) AS VIOLT_ROOT_NM,
                       TO_CHAR(A.WRITNG_DT,'YYYY.MM.DD') AS WRITNG_DT,
                       TO_CHAR(A.ARRST_DT,'YYYY.MM.DD HH24:MI') AS ARRST_DT,
                       A.ARRST_PLACE,
                       A.ARRESTER_CLSS ||DECODE(A.ARRESTER_CLSS, NULL, '',' ')|| A.ARRESTER_NM AS ARRESTER,
                       TO_CHAR(A.ATTRACT_DT,'YYYY.MM.DD HH24:MI') AS ATTRACT_DT,
                       A.ATTRACT_PLACE,
                       TO_CHAR(A.CNFNM_DT,'YYYY.MM.DD HH24:MI') AS CNFNM_DT,
                       A.CNFNM_PLACE,
                       DECODE(A.SUGEST_RESULT_CD, 'Y', 'Y', 'N') AS SUGEST_RESULT_Y,  /*검사지휘 승인, 불승인*/
                       DECODE(A.SUGEST_RESULT_CD, 'N', 'Y', 'N') AS SUGEST_RESULT_N,
                       A.RSL_DT,
                       A.RSL_RESN_CD ||DECODE(A.RSL_RESN_CD,NULL,'',' ')|| A.RSL_RESN_ETC AS RSL_RESN,
					   DECODE(A.ZRLONG_REQST_YN,'Y','신청','N','미신청', '') AS ZRLONG_REQST_YN, /*구속영장신청, 신청부 번호, 발부 연원일*/
					   A.ARRESTER_NM,
					   DGUARD.DECRYPT('TBL','ENC',A.ARRESTER_RRN) AS ARRESTER_RRN,
					   A.ARRESTER_CLSS,
					   A.ARRESTER_DWLSIT,
					   A.UNDTAKE_DT,
					   A.UNDTAKE_PLACE,
					   NVL(F.RSPOFC_CD, F.CLSF_CD) AS ACPTR_CLSS,
                       F.USER_NM AS ACPTR_NM
                    FROM INV_PRSCT_ARRST A
                    LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
                    LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
                    LEFT JOIN CMN_USER F ON A.ACPTR_ID = F.ESNTL_ID
                    WHERE C.USE_YN = 'Y'
                      AND A.ARRST_TY_CD = #arrst_ty_cd#
                    <isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>
            ) A
            WHERE 1=1
            <isNotEmpty property="prsct_de1" >
				AND A.WRITNG_DT <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
			</isNotEmpty>
			<isNotEmpty property="prsct_de2" >
				AND A.WRITNG_DT <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
			</isNotEmpty>
        ) X
        ORDER BY RN ASC
	</select>
	<select id="selectStsSzureList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.ZRLONG_REQST_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.ZRLONG_REQST_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						/*DENSE_RANK() OVER (ORDER BY A.ZRLONG_REQST_NO) AS RN*/
                        A.ZRLONG_REQST_NO,
                        R.ZRLONG_NO,
                        D.CASE_NO,
                        C.RC_NO,
                        A.REQST_DE,
                        FN_CD_NM(NVL(E.RSPOFC_CD, E.CLSF_CD)) || ' ' || E.USER_NM AS REQST_NM,
                        C.TRGTER_NM,
                        DGUARD.DECRYPT('TBL','ENC',C.TRGTER_RRN) AS TRGTER_RRN,
                        FN_CD_NM(C.OCCP_CD) AS OCCP_NM,
                        C.DWLSIT_ADDR,
                        FN_RC_VIOLT_ROOT_NM (A.RC_NO) AS VIOLT_ROOT_NM,
                        DECODE(R.DSMSSL_INSTT_CD, 'P', TO_CHAR(R.EXCUT_DT,'YYYY-MM-DD HH24:MI')) AS PP_DSMSSL_INSTT,         	/*검찰사-검사*/
                        DECODE(R.DSMSSL_INSTT_CD, 'C', TO_CHAR(R.EXCUT_DT,'YYYY-MM-DD HH24:MI')) AS CC_DSMSSL_INSTT,         	/*법원-판사*/
                        TO_CHAR(R.ISUE_DT,'YYYY-MM-DD HH24:MI') AS ISUE_DT,
                        TO_CHAR(NVL(R.VALID_DT,A.VALID_DT),'YYYY-MM-DD') AS VALID_DT
                        /*석방일시*/
                        /*석방장소*/
                        /*처리결과*/
                        /*
                        	2021.01.18
                        	coded by dgkim
                        	집행일시, 집행장소, 처리결과 추가
                        	김지만 수사관 요청
                        */
                        , TO_CHAR(R.EXCUT_DT,'YYYY-MM-DD HH24:MI') AS SZURE_RST_EXCUT_DT --집행일시 
						, R.EXCUT_PLACE --집행장소 
						, DECODE(R.EXCUT_SE_CD, 'Y', '집행', 'N', '집행불능', 'R', '반환') AS EXCUT_SE_NM --처리결과 
                  	FROM INV_SZURE_REQST A
                    LEFT JOIN INV_SZURE_APPLCNT B ON A.ZRLONG_REQST_NO = B.ZRLONG_REQST_NO
                    LEFT JOIN RC_TMPR_TRGTER C ON B.RC_NO = C.RC_NO AND B.TRGTER_SN = C.TRGTER_SN
                    LEFT JOIN INV_SZURE_RESULT R ON A.ZRLONG_REQST_NO = R.ZRLONG_REQST_NO
                    LEFT JOIN RC_TMPR D ON A.RC_NO = D.RC_NO
                    LEFT JOIN CMN_USER E ON A.WRITNG_ID = E.ESNTL_ID
                    WHERE C.USE_YN = 'Y'
                      AND NVL(R.ZRLONG_NO,0) = (SELECT NVL(MAX(RR.ZRLONG_NO),0) FROM INV_SZURE_RESULT RR WHERE RR.ZRLONG_REQST_NO = A.ZRLONG_REQST_NO)
					<isNotEmpty property="zrlong_se_cd" >
						AND A.ZRLONG_SE_CD = #zrlong_se_cd#
					</isNotEmpty>
					<isNotEmpty property="trgter_nm" >
						AND C.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND D.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND D.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND A.REQST_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND A.REQST_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>
	<select id="selectStsAtendList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.VIEW_SN, A.DEMAND_SN) RN
				</isEmpty>
			FROM
				(
					SELECT
						A.DEMAND_SN,
						TO_CHAR(A.ATEND_DEMAND_DT,'YYYY.MM.DD.HH24:MI') AS ATEND_DEMAND_DT,
						FN_CD_NM(D.TRGTER_SE_CD) AS TRGTER_SE_NM,
						D.TRGTER_NM,
						A.RC_NO,
						C.CASE_NO,
						A.ATEND_NTICE_DE,
						FN_CD_NM(A.ATEND_NTICE_CD) AS ATEND_NTICE_NM,
						DECODE(A.ATEND_YN,'Y','출석','N','미출석','') AS ATEND_RST,
						FN_USER_NM(CHARGER_ID) AS CHARGER_NM,
						A.VIEW_SN,
						A.TRGTER_SN, --대상자 일련번호
						A.ATEND_YN --조회 일련번호
					FROM INV_PRSCT_ATEND A
					LEFT JOIN RC_TMPR_TRGTER D ON A.RC_NO = D.RC_NO AND A.TRGTER_SN = D.TRGTER_SN
					LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
					WHERE A.USE_YN = 'Y'
					<isNotEmpty property="trgter_nm" >
						AND D.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND A.ATEND_NTICE_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND A.ATEND_NTICE_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>					
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>

	<select id="selectStsCcdrcList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM
		(
			SELECT
			A.*,			
			COUNT(*) OVER() AS TOT_CNT,
			<isNotEmpty property="dataField">
				<isNotEmpty property="sortType">
					ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
				</isNotEmpty>
			</isNotEmpty>
			<isEmpty property="dataField">		
				ROW_NUMBER() OVER(ORDER BY A.CCDRC_NO, A.CCDRC_SN) AS RN
			</isEmpty>
			FROM
			(
				SELECT
			        IC.RC_NO,
			        RT.CASE_NO,
			        IC.CCDRC_NO,
			        IC.CCDRC_SN,
			        IC.CCDRC_NM,
			        IC.CCDRC_QY,
			        IC.CCDRC_DC,
			        TO_CHAR(TO_DATE(IC.SZURE_DE,'YYYYMMDD'),'YYYY-MM-DD') AS SZURE_DE,
			        TO_CHAR(TO_DATE(IC.DSPS_DE,'YYYYMMDD'),'YYYY-MM-DD') AS DSPS_DE,
			        FN_CD_NM(IC.DSPS_CD) AS DSPS_NM,
			        IC.DSPS_RM,
			        IC.POLC_OPINION,
			        FN_CCDRC_TRGTER_NM(IC.CCDRC_NO, IC.CCDRC_SN, IC.RC_NO, 'S') AS CF_SZURE_TRGTER_NM,
			        FN_CCDRC_TRGTER_NM(IC.CCDRC_NO, IC.CCDRC_SN, IC.RC_NO, 'P') AS CF_POSESN_TRGTER_NM,
			        '' AS CONFM,
			        DECODE(IC.RNDM_PRESENTN_YN, 'Y', '임의제출', '') AS ETC
					FROM INV_CCDRC IC,
					RC_TMPR RT
					WHERE RT.USE_YN= 'Y'
					AND IC.USE_YN = 'Y'
					AND RT.RC_NO = IC.RC_NO
				<isNotEmpty property="searchChager" >
					AND RT.CHARGER_ID = #searchChager#
				</isNotEmpty>
				<isNotEmpty property="searchDeptCd" >
					AND RT.CHARGER_DEPT_CD IN (
						SELECT DC.DEPT_CD
						FROM CMN_DEPT_CD DC
						WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
						START WITH DC.DEPT_CD = #searchDeptCd#
						CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
					)
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoStart" >
					AND RT.CASE_NO <![CDATA[ >= ]]> #searchCaseNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoEnd" >
					AND RT.CASE_NO <![CDATA[ <= ]]> #searchCaseNoEnd#
				</isNotEmpty>
				<isNotEmpty property="searchDeStart" >
					AND IC.SZURE_DE <![CDATA[ >= ]]> REPLACE(#searchDeStart#,'-','')
				</isNotEmpty>
				<isNotEmpty property="searchDeEnd" >
					AND IC.SZURE_DE <![CDATA[ <= ]]> REPLACE(#searchDeEnd#,'-','')
				</isNotEmpty>
				<isNotEmpty property="chkYn">
				   AND IC.RNDM_PRESENTN_YN = #chkYn#
				</isNotEmpty>
			) A
			<isNotEmpty property="searchTrgterNm">
				WHERE A.CF_SZURE_TRGTER_NM = #searchTrgterNm#
			</isNotEmpty>
		) X
		<isNotEmpty property="startRow" >
		WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>

	<select id="selectStsSugestList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*, 
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.SUGEST_NO, A.RC_NO) AS RN
				</isEmpty>
			FROM
				(
					SELECT
			        S.SUGEST_NO,
			        S.RC_NO,
			        C.CASE_NO,
			        S.TRGTER_SN,
			        S.SUGEST_TY_CD,
					FN_CD_NM(S.SUGEST_TY_CD) AS SUGEST_TY_NM,
			        S.SUGEST_CL_CD,
			        FN_CD_NM(S.SUGEST_CL_CD) AS SUGEST_CL_NM,
			        S.INV_SUGEST_YN,
			        S.SUGEST_RESULT_CD,
			        (
			        	CASE WHEN S.SUGEST_RESULT_CD = 'Y' THEN '가'
						WHEN S.SUGEST_RESULT_CD = 'N' THEN '부'
						WHEN S.SUGEST_RESULT_CD = 'C' THEN '비고'
						ELSE '' END
					) AS SUGEST_RESULT_NM,
			        TO_CHAR(TO_DATE(S.SUGEST_DE,'YYYYMMDD'),'YYYY-MM-DD') AS SUGEST_DE,
			        S.SUGEST_CN,
			        S.RSL_RESN,
			        TO_CHAR(TO_DATE(S.CMND_DE,'YYYYMMDD'),'YYYY-MM-DD') AS CMND_DE,
			        S.CMND_CN,
			        S.CMND_PRSEC_NM,
			        S.DOC_ID,
			        S.FILE_ID,
			        S.WRITNG_ID,
			        S.WRITNG_DT,
			        S.UPDT_ID,
			        S.UPDT_DT,
					(SELECT FN_EXMN_NM(IP.CMPTNC_EXMN_CD) FROM RC_TMPR IP WHERE IP.RC_NO = S.RC_NO) AS CMPTNC_EXMN_NM,
					FN_RC_TRGTER_NM (S.RC_NO, '00697') AS TRGTER_NM_S,  /*피의자*/
					FN_CD_NM (C.INV_PROVIS_CD) AS INV_PROVIS_NM,
					DECODE(C.RC_SE_CD, 'T' ,'임시','I','내사','F','정식') AS RC_SE_NM,
					FN_RC_VIOLT_ROOT_NM (S.RC_NO) AS VIOLT_ROOT_NM,
					S.PRESENTER, /* 제출자 */
					/*
						2021.01.18
						coded by dgkim
						수령자 칼럼 추가
						김지만 수사관 요청
					*/
					S.RECIPIENT /* 수령자 */
					FROM INV_SUGEST S
					JOIN RC_TMPR C ON S.RC_NO = C.RC_NO
					WHERE S.USE_YN = 'Y'
					<isNotEmpty property="trgter_nm" >
						AND C.RC_NO IN (
							SELECT TT.RC_NO
							FROM RC_TMPR_TRGTER TT
							WHERE TT.TRGTER_NM = #trgter_nm#
							<isNotEmpty property="trgter_cl" prepend="AND">
								TT.TRGTER_SE_CD = #trgter_cl#
							</isNotEmpty>
						)
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND C.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND C.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>					
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>

	<select id="selectStprscList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*,						
			FN_CHK_DATE (X.RC_NO, X.TRGTER_SN, 'S', X.TRN_DE) AS CHK_DT
		FROM (
			SELECT A.*, 
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.DSCVRY_NO, A.RC_NO) RN
				</isEmpty>
			FROM
				(
					SELECT
					B.CMND_DE, 
					B.CMND_GRFC_NM, 
					B.REPORT_DE, 
					B.REPORT_CN,					
					T.RC_NO||TT.TRGTER_SN AS MG_NO,
                    TT.TRGTER_SN,
                    TT.TRGTER_NM,
                    I.DSCVRY_NO,
                    T.CASE_NO,
                    T.RC_NO,
                    I.DSCVRY_RESN,
                    I.DSCVRY_DE,
                    I.DSCVRY_REPORT_DE,
                    FN_RC_VIOLT_ROOT_NM (RT.RC_NO) AS VIOLT_NM,
                    I.SRCCRM_RELIS_DE,
                    (SELECT MAX(B.TRN_DE) FROM TRN_CASE B WHERE RC_NO = T.RC_NO AND B.USE_YN = 'Y') AS TRN_DE,
                    (SELECT FN_CD_NM(MAX(C.TRN_OPINION_CD) KEEP(DENSE_RANK FIRST ORDER BY C.TRN_NO DESC))
                       FROM TRN_VIOLT C
                      WHERE C.RC_NO = I.RC_NO
                        AND C.TRGTER_SN = I.TRGTER_SN) AS TRN_OPINION_NM,
                    FN_USER_NM(T.CHARGER_ID) AS CHARGER_NM
                    FROM (
                        SELECT RC_NO FROM (
                            SELECT A.RC_NO FROM RC_TMPR A
                            WHERE A.USE_YN = 'Y'
                             AND A.PROGRS_STTUS_CD = '02124'            /*기소중지*/
                             AND A.RC_NO IN (
                                SELECT DISTINCT TT.RC_NO
                                FROM RC_TMPR_TRGTER TT
                                JOIN RC_TMPR RR ON TT.RC_NO = RR.RC_NO AND RR.USE_YN = 'Y' AND RR.PROGRS_STTUS_CD = '02124'
                                 WHERE TT.USE_YN = 'Y'
                                  AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'suspct-Group' )         /*피의자*/
                            )
							<isNotEmpty property="chager" >
								AND A.CHARGER_ID = #chager#
							</isNotEmpty>
							<isNotEmpty property="dept_cd" >
								AND A.CHARGER_DEPT_CD IN (
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							</isNotEmpty>
							<isNotEmpty property="rc_no1" >
								AND A.RC_NO LIKE #rc_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="rc_no2" >
								AND A.RC_NO <![CDATA[ >= ]]> (SUBSTR(A.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="rc_no3" >
								AND A.RC_NO <![CDATA[ <= ]]> (SUBSTR(A.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no1" >
								AND A.CASE_NO LIKE #case_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="case_no2" >
								AND A.CASE_NO <![CDATA[ >= ]]> (SUBSTR(A.CASE_NO,0,5)||LPAD(#case_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no3" >
								AND A.CASE_NO <![CDATA[ <= ]]> (SUBSTR(A.CASE_NO,0,5)||LPAD(#case_no3#,6,'0'))
							</isNotEmpty>

							<isNotEmpty property="prsct_de1" >
								AND A.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
							</isNotEmpty>
							<isNotEmpty property="prsct_de2" >
								AND A.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
							</isNotEmpty>
                            UNION ALL
                            SELECT B.RC_NO FROM INV_STPRSC B
                            JOIN RC_TMPR C ON B.RC_NO = C.RC_NO
                            WHERE C.USE_YN = 'Y'
                            <isNotEmpty property="chager" >
								AND C.CHARGER_ID = #chager#
							</isNotEmpty>
							<isNotEmpty property="dept_cd" >
								AND C.CHARGER_DEPT_CD IN (
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							</isNotEmpty>
							<isNotEmpty property="rc_no1" >
								AND C.RC_NO LIKE #rc_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="rc_no2" >
								AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="rc_no3" >
								AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no1" >
								AND C.CASE_NO LIKE #case_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="case_no2" >
								AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.CASE_NO,0,5)||LPAD(#case_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no3" >
								AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.CASE_NO,0,5)||LPAD(#case_no3#,6,'0'))
							</isNotEmpty>

							<isNotEmpty property="prsct_de1" >
								AND C.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
							</isNotEmpty>
							<isNotEmpty property="prsct_de2" >
								AND C.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
							</isNotEmpty>
                        ) GROUP BY RC_NO
                    ) RT
                    JOIN RC_TMPR T ON RT.RC_NO = T.RC_NO
                    JOIN (
                        SELECT
                            CC.RC_NO,
                            CC.TRGTER_SN,
                            RT.TRGTER_NM,
                            MAX(CC.TRN_NO) AS TRN_NO,
                            MAX(D.TRN_DE) KEEP(DENSE_RANK FIRST ORDER BY CC.TRN_NO DESC) AS TRN_DE
                        FROM TRN_VIOLT CC
                        JOIN TRN_CASE D ON D.TRN_NO = CC.TRN_NO AND D.USE_YN = 'Y'
                        JOIN RC_TMPR CT ON CC.RC_NO = CT.RC_NO
                        JOIN RC_TMPR_TRGTER RT ON CT.RC_NO = RT.RC_NO AND CC.TRGTER_SN = RT.TRGTER_SN AND RT.USE_YN = 'Y'
                        WHERE CC.USE_YN = 'Y'
                          <isNotEmpty property="chager" >
								AND CT.CHARGER_ID = #chager#
							</isNotEmpty>
							<isNotEmpty property="dept_cd" >
								AND CT.CHARGER_DEPT_CD IN (
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							</isNotEmpty>
							<isNotEmpty property="rc_no1" >
								AND CT.RC_NO LIKE #rc_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="rc_no2" >
								AND CT.RC_NO <![CDATA[ >= ]]> (SUBSTR(CT.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="rc_no3" >
								AND CT.RC_NO <![CDATA[ <= ]]> (SUBSTR(CT.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no1" >
								AND CT.CASE_NO LIKE #case_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="case_no2" >
								AND CT.CASE_NO <![CDATA[ >= ]]> (SUBSTR(CT.CASE_NO,0,5)||LPAD(#case_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no3" >
								AND CT.CASE_NO <![CDATA[ <= ]]> (SUBSTR(CT.CASE_NO,0,5)||LPAD(#case_no3#,6,'0'))
							</isNotEmpty>

							<isNotEmpty property="prsct_de1" >
								AND CT.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
							</isNotEmpty>
							<isNotEmpty property="prsct_de2" >
								AND CT.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
							</isNotEmpty>
                          AND D.ED_YN = 'Y'                        /*종결여부*/
                          AND CC.TRN_OPINION_CD = '01367'        /*피의자소재불명*/
                          AND RT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'suspct-Group' ) /*피의자 그룹*/
                        GROUP BY CC.RC_NO, CC.TRGTER_SN, RT.TRGTER_NM
                    ) TT ON T.RC_NO = TT.RC_NO
                    LEFT JOIN INV_STPRSC_DSCVRY I ON TT.RC_NO = I.RC_NO AND TT.TRGTER_SN = I.TRGTER_SN
                    LEFT JOIN INV_STPRSC_REPORT B ON TT.RC_NO = B.RC_NO AND TT.TRGTER_SN = B.TRGTER_SN
                    WHERE T.USE_YN = 'Y'
                    <isNotEmpty property="trgter_nm" prepend="AND">
						TT.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="trgter_cl" prepend="AND">
						TT.TRGTER_SE_CD = #trgter_cl#
					</isNotEmpty>					
			) A
		) X		
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>

	<select id="selectRefeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*,						
			FN_CHK_DATE (X.RC_NO, X.TRGTER_SN, 'R', X.TRN_DE) AS CHK_DT
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.DSCVRY_NO, A.CASE_NO) RN
				</isEmpty>				
			FROM
				(
					SELECT
                    I.DSCVRY_NO,
                    TT.TRGTER_SN,
                    TT.TRGTER_NM,
                    T.CASE_NO,
                    T.RC_NO,
                    I.DSCVRY_RESN,
                    I.DSCVRY_DE,
                    I.DSCVRY_REPORT_DE,
                    FN_RC_VIOLT_ROOT_NM (T.RC_NO) AS VIOLT_NM,
                    (SELECT MAX(B.TRN_DE) FROM TRN_CASE B WHERE RC_NO = T.RC_NO AND B.USE_YN = 'Y') AS TRN_DE,
                    (SELECT
                         LISTAGG(C.TRN_OPINION_CD,',') WITHIN GROUP (ORDER BY C.TRGTER_SN) AS L_TRN_OPINION_CD
                         FROM TRN_VIOLT C
                        WHERE C.RC_NO =  I.RC_NO
                          AND C.TRGTER_SN =  I.TRGTER_SN
                          AND C.TRN_NO = (SELECT MAX(VT.TRN_NO) FROM TRN_VIOLT VT WHERE VT.RC_NO = I.RC_NO AND VT.TRGTER_SN = I.TRGTER_SN)
                    ) AS TRN_OPINION_NM,
                    FN_USER_NM(T.CHARGER_ID) AS CHARGER_NM,
                    T.RC_NO||TT.TRGTER_SN AS MG_NO,
                    B.CMND_DE, 
					B.CMND_GRFC_NM, 
					B.REPORT_DE, 
					B.REPORT_CN,
					B.REPORT_SN
                    FROM (
                        SELECT RC_NO FROM (
                            SELECT A.RC_NO FROM RC_TMPR A
                            WHERE A.USE_YN = 'Y'
                             AND A.PROGRS_STTUS_CD = '02125' /*참고인중지*/
                             AND A.RC_NO IN (
                                SELECT DISTINCT TT.RC_NO
                                FROM RC_TMPR_TRGTER TT
                                JOIN RC_TMPR RR ON TT.RC_NO = RR.RC_NO AND RR.USE_YN = 'Y' AND RR.PROGRS_STTUS_CD = '02125' /*참고인중지*/
                                 WHERE TT.USE_YN = 'Y'
                                  AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'accs-Group' ) /*참고인 그룹*/
                            )
							<isNotEmpty property="chager" >
								AND A.CHARGER_ID = #chager#
							</isNotEmpty>
							<isNotEmpty property="dept_cd" >
								AND A.CHARGER_DEPT_CD IN (
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							</isNotEmpty>
							<isNotEmpty property="rc_no1" >
								AND A.RC_NO LIKE #rc_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="rc_no2" >
								AND A.RC_NO <![CDATA[ >= ]]> (SUBSTR(A.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="rc_no3" >
								AND A.RC_NO <![CDATA[ <= ]]> (SUBSTR(A.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no1" >
								AND A.CASE_NO LIKE #case_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="case_no2" >
								AND A.CASE_NO <![CDATA[ >= ]]> (SUBSTR(A.CASE_NO,0,5)||LPAD(#case_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no3" >
								AND A.CASE_NO <![CDATA[ <= ]]> (SUBSTR(A.CASE_NO,0,5)||LPAD(#case_no3#,6,'0'))
							</isNotEmpty>

							<isNotEmpty property="prsct_de1" >
								AND A.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
							</isNotEmpty>
							<isNotEmpty property="prsct_de2" >
								AND A.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
							</isNotEmpty>
                            UNION ALL
                            SELECT B.RC_NO FROM INV_REFESTPGE B
                            JOIN RC_TMPR C ON B.RC_NO = C.RC_NO
                            WHERE C.USE_YN = 'Y'
                            <isNotEmpty property="chager" >
								AND C.CHARGER_ID = #chager#
							</isNotEmpty>
							<isNotEmpty property="dept_cd" >
								AND C.CHARGER_DEPT_CD IN (
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							</isNotEmpty>
							<isNotEmpty property="rc_no1" >
								AND C.RC_NO LIKE #rc_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="rc_no2" >
								AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="rc_no3" >
								AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no1" >
								AND C.CASE_NO LIKE #case_no1# || '%'
							</isNotEmpty>
							<isNotEmpty property="case_no2" >
								AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.CASE_NO,0,5)||LPAD(#case_no2#,6,'0'))
							</isNotEmpty>
							<isNotEmpty property="case_no3" >
								AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.CASE_NO,0,5)||LPAD(#case_no3#,6,'0'))
							</isNotEmpty>

							<isNotEmpty property="prsct_de1" >
								AND C.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
							</isNotEmpty>
							<isNotEmpty property="prsct_de2" >
								AND C.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
							</isNotEmpty>
                        ) GROUP BY RC_NO
                    ) RT
                    JOIN RC_TMPR T ON RT.RC_NO = T.RC_NO
                    JOIN RC_TMPR_TRGTER TT ON T.RC_NO = TT.RC_NO AND TT.USE_YN = 'Y'
                    	AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'accs-Group' )
                    LEFT JOIN INV_REFE_DSCVRY I ON TT.RC_NO = I.RC_NO AND TT.TRGTER_SN = I.TRGTER_SN
                    LEFT JOIN INV_REFE_REPORT B ON TT.RC_NO = B.RC_NO AND TT.TRGTER_SN = B.TRGTER_SN
                    WHERE T.USE_YN = 'Y'
                    <isNotEmpty property="trgter_nm" prepend="AND">
						TT.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="trgter_cl" prepend="AND">
						TT.TRGTER_SE_CD = #trgter_cl#
					</isNotEmpty>					
			) A
		) X		
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>

	<select id="selectVidoTrplant" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*, 
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.WRITNG_DT, A.CASE_NO, A.RC_NO) AS RN
				</isEmpty>
			FROM
				(
					SELECT
						R.RC_NO,
					    F.DOC_ID,
					    F.PBLICTE_SN,
					    F.FORMAT_ID,
					    M.FORMAT_NM,
					    DECODE(R.RC_SE_CD, 'T' ,R.TMPR_NO,'I',R.ITIV_NO,'F',R.CASE_NO) CASE_NO,
					    R.PRSCT_DE,
					    FN_CD_NM (R.INV_PROVIS_CD) AS INV_PROVIS_NM,
					    DECODE(R.RC_SE_CD, 'T' ,'임시','I','내사','F','정식') AS RC_SE_NM,
					    G.TRGTER_NM,
					    FN_RC_VIOLT_ROOT_NM (R.RC_NO) AS VIOLT_NM,
					    FN_USER_NM(F.WRITNG_ID) AS WRITNG_NM,
					    F.WRITNG_DT,
					    C.VIDO_TRPLANT_CHARGER,
					    C.VIDO_TRPLANT_DE
					FROM CMN_DOC_PBLICTE F
					JOIN CMN_FORMAT_MANAGE M ON F.FORMAT_ID = M.FORMAT_ID AND M.USE_YN = 'Y'
					JOIN RC_TMPR_TRGTER G ON F.DOC_ID = G.DOC_ID
					JOIN RC_TMPR R ON G.RC_NO = R.RC_NO
					LEFT JOIN VIDO_TRPLANT C ON F.DOC_ID = C.DOC_ID AND F.PBLICTE_SN = C.PBLICTE_SN
					WHERE F.FORMAT_ID = '00000000000000000021'
					  AND F.USE_YN = 'Y' 
					  /*
					  	2021.11.30
					  	coded by dgkim
					  	영상녹화동의서 저장된것만 나오게끔 수정
					  */
					  AND F.FILE_NM IS NOT NULL
					<isNotEmpty property="trgter_nm" >
						AND R.RC_NO IN (
							SELECT TT.RC_NO
							FROM RC_TMPR_TRGTER TT
							WHERE TT.TRGTER_NM = #trgter_nm#
							<isNotEmpty property="trgter_cl" prepend="AND">
								TT.TRGTER_SE_CD = #trgter_cl#
							</isNotEmpty>
						)
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND R.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND R.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND R.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND R.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND R.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND R.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND R.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND R.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND R.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND R.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>					
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
	</select>
	
	<!-- 
		2021.08.02
		coded by dgkim
		출석요구통지부 > 출석요구시간 및 결과 수정 기능 추가
		김지만 수사관 요청
	 -->
	<update id="updateAtend" parameterClass="java.util.HashMap">
		UPDATE INV_PRSCT_ATEND
			SET ATEND_DEMAND_DT = TO_DATE(#grdAtendDemandDt#, 'YYYY-MM-DD HH24:MI') --출석 요구 일시
				, ATEND_YN = #grdAtendYn# --출석 여부
				, UPDT_ID = #esntl_id# --수정 ID
				, UPDT_DT = SYSDATE --수정 일시
		WHERE RC_NO = #grdRcNo# --접수 번호
			AND TRGTER_SN = #grdTrgterSn# --대상자 일련번호
			AND DEMAND_SN = #grdDemandSn# --요구 일련번호
	</update>
	
	<!-- 
		2021.08.03
		coded by dgkim
		지휘건의부 제출자 입력란 추가
		김지만 수사관 요청
		
		edit by dgkim
		지휘건의부 수령자 입력란 추가
	 -->
	 <update id="updateSugestStats" parameterClass="java.util.HashMap">
		UPDATE INV_SUGEST
			SET PRESENTER = #grdPresenter# --제출자
				, RECIPIENT = #grdRecipient# --수령자
				, UPDT_ID = #esntl_id# --수정 ID
				, UPDT_DT = SYSDATE --수정 일시
		WHERE SUGEST_NO = #grdSugestNo# --건의 번호
			AND RC_NO = #grdRcNo# --접수 번호
	 </update>
	 
	 <!-- 
	 	2021.08.10
	 	coded by dgkim
	 	체포구속인명부 메뉴 추가
	 	김지만 수사관 요청
	  -->
	 <select id="selectArrstNmstList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.ARRST_SN, A.CASE_NO) AS RN
				</isEmpty>
			FROM
				(
					SELECT 
						ipa.RC_NO
						, FN_CASE_NO(ipa.RC_NO) AS CASE_NO --사건번호
						, ipa.ARRST_SN
						
						--체포구속
						, DECODE('C', 'C', 'Y', 'D', '', 'I', '') AS TRTMNT_CHFCLRK --취급자(계장) 
						, DECODE('C', 'C', '', 'D', 'Y', 'I', '') AS TRTMNT_DRHF --취급자(과장)
						, DECODE('C', 'C', '', 'D', '', 'I', 'Y') AS TRTMNT_ISTDR --취급자(기관장)
						
						, ipa.ARRST_DT --체포,구속 연월일
						, FN_CD_NM(ipa.ARRST_TY_CD) AS ARRST_TY_NM --체포,구속 유형
						
						--석방
						, DECODE('I', 'C', 'Y', 'D', '', 'I', '') AS TRTMNT2_CHFCLRK --취급자(계장)
						, DECODE('I', 'C', '', 'D', 'Y', 'I', '') AS TRTMNT2_DRHF --취급자(과장)
						, DECODE('I', 'C', '', 'D', '', 'I', 'Y') AS TRTMNT2_ISTDR --취급자(기관장)
				
						, ipa.RSL_DT --석방 연월일시
						, ipa.RSL_RESN_ETC --사유
						, FN_RC_VIOLT_ROOT_NM(ipa.RC_NO) AS VIOLT_NM --(SELECT FN_VIOLT_NM(VIOLT_CD) FROM RC_TMPR_VIOLT WHERE RC_NO = ipa.RC_NO AND VIOLT_SN = rtt.TRGTER_SN) AS VIOLT_NM --죄명
						, '' AS HEIGHT--키
						, '' AS BODY --몸집
						, '' AS WIG --머리털
						, '' AS EYEBrOW --눈썹
						, '' AS MUSTACHE --수염
						, '' AS BROW --이마
						, '' AS EAR --귀
						, '' AS EYE --눈
						, '' AS MOUTH --입
						, '' AS TEETH --이
						, '' AS NOSE --코
						, '' AS ASPECT --용모
						, '' AS FACE --얼굴
						, '' AS FACE_COLOR --얼굴색
						, '' AS ETC --기타특징
						, '' AS CLOTHING --착의
						, rtt.TRGTER_NM --성명
						, DGUARD.DECRYPT('TBL','ENC', rtt.TRGTER_RRN) AS TRGTER_RRN --주민번호
						, rtt.REGBS_ADDR --등록기준지
						, '' AS PRE_CONVICTION --전과
						, '' AS COMPLC --공범 성명
						, '' AS FAMILY_RELATIONS --가족관계
					FROM INV_PRSCT_ARRST ipa
						INNER JOIN RC_TMPR_TRGTER rtt
						ON ipa.RC_NO = rtt.RC_NO AND ipa.TRGTER_SN = rtt.TRGTER_SN
						
						INNER JOIN RC_TMPR rt
						ON rt.RC_NO = rtt.RC_NO
					WHERE rt.USE_YN = 'Y'
						<isNotEmpty property="trgter_nm" >
							AND rtt.TRGTER_NM LIKE '%' || #trgter_nm# || '%'
						</isNotEmpty>
						
						<isNotEmpty property="chager" >
							AND rt.CHARGER_ID = #chager#
						</isNotEmpty>
						
						<isNotEmpty property="dept_cd" >
							AND rt.CHARGER_DEPT_CD IN (
								SELECT DC.DEPT_CD
								FROM CMN_DEPT_CD DC
								WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
								START WITH DC.DEPT_CD = #dept_cd#
								CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
							)
						</isNotEmpty>
						
						<isNotEmpty property="prsct_de1">
							<isNotEmpty property="prsct_de2">
								AND ipa.ARRST_DT BETWEEN TO_DATE(#prsct_de1#, 'YYYY-MM-DD') AND TO_DATE(#prsct_de2#, 'YYYY-MM-DD') + 0.99999
							</isNotEmpty>
						</isNotEmpty>
				) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		
		ORDER BY RN ASC
	 </select>
</sqlMap>