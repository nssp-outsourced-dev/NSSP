<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="stats">

	<select id="selectCaseManageList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
		X.RN,
		X.TOT_CNT,
		X.RC_NO,
		X.ITIV_NO,
		X.CASE_NO,
		X.RC_SE_CD,
		X.INV_PROVIS_NM,
		X.PROGRS_STTUS_NM,
	    X.CHARGER_NM,
	    X.CHARGER_DEPT_NM,
		X.VIOLT_NM,
		X.SUSPCT_NM,
		X.SUFRER_NM,
		X.PRSCT_DE,
		X.TRN_DE
		FROM
		(
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">
					/* 
						2021.07.12
						by dgkim
						사건번호순으로 정렬로 변경(사건번호 > 내사번호)
						김지만 수사관 요청
					 */
					 /* 
						2021.09.08
						by dgkim
						사건번호 > 내사번호 > 접수번호 순으로 정렬로 변경
						김지만 수사관 요청
					 */
					ROW_NUMBER() OVER(ORDER BY A.CASE_NO ASC, A.ITIV_NO ASC, A.RC_NO ASC) RN --ROW_NUMBER() OVER(ORDER BY A.RC_NO) RN
				</isEmpty>				
			FROM
			(
				SELECT
				RT.RC_NO,
				RT.ITIV_NO,
				RT.CASE_NO,
				RT.RC_SE_CD,
				RT.PROGRS_STTUS_CD,
				TO_CHAR(TO_DATE(RT.PRSCT_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS PRSCT_DE,
				RT.INV_PROVIS_CD,
				FN_CD_NM(RT.INV_PROVIS_CD) AS INV_PROVIS_NM,
				FN_CD_NM(RT.PROGRS_STTUS_CD) AS PROGRS_STTUS_NM,
				FN_USER_NM(RT.CHARGER_ID) AS CHARGER_NM,
				FN_DEPT_NM(RT.CHARGER_DEPT_CD) AS CHARGER_DEPT_NM,
				FN_RC_VIOLT_UPPER_NMS(RT.RC_NO) AS VIOLT_NM,
				FN_RC_TRGTER_NM(RT.RC_NO,'00697') AS SUSPCT_NM,
				FN_RC_TRGTER_NM(RT.RC_NO,'00698') AS SUFRER_NM,
				NVL((SELECT TO_CHAR(TO_DATE(MAX(TC.TRN_DE), 'YYYYMMDD'), 'YYYY-MM-DD') FROM TRN_CASE TC WHERE TC.RC_NO = RT.RC_NO AND TC.USE_YN = 'Y'),'') AS TRN_DE
				FROM RC_TMPR RT
				WHERE RT.USE_YN = 'Y'
				<isNotEmpty property="searchTrgterNm" >
					AND RT.RC_NO IN (
						SELECT TT.RC_NO
						FROM RC_TMPR_TRGTER TT
						WHERE TT.TRGTER_NM = #searchTrgterNm#
						<isNotEmpty property="searchTrgterCl" prepend="AND">
							TT.TRGTER_SE_CD = #searchTrgterCl#
						</isNotEmpty>
					)
				</isNotEmpty>
				<isNotEmpty property="searchChager" >
					AND RT.CHARGER_ID = #searchChager#
				</isNotEmpty>
				<isNotEmpty property="searchDeptCd" >
					AND RT.CHARGER_DEPT_CD IN (
						SELECT DC.DEPT_CD
						FROM CMN_DEPT_CD DC
						WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
						START WITH DC.DEPT_CD = #searchDeptCd#
						CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
					)
				</isNotEmpty>
				<isNotEmpty property="searchRcNoStart" >
					AND RT.RC_NO <![CDATA[ >= ]]> #searchRcNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchRcNoEnd" >
					AND RT.RC_NO <![CDATA[ <= ]]> #searchRcNoEnd#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoStart" >
					AND RT.CASE_NO <![CDATA[ >= ]]> #searchCaseNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoEnd" >
					AND RT.CASE_NO <![CDATA[ <= ]]> #searchCaseNoEnd#
				</isNotEmpty>

				<isNotEmpty property="searchPrsctDeStart" >
					AND RT.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#searchPrsctDeStart#,'-','')
				</isNotEmpty>
				<isNotEmpty property="searchPrsctDeEnd" >
					AND RT.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#searchPrsctDeEnd#,'-','')
				</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>


	<select id="selectCrimeCaseList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.RN
			 , X.TOT_CNT
			 , X.RC_NO
			 , X.ITIV_NO
			 , FN_CNVR_NO(X.CASE_NO) AS CASE_NO
			 , X.RC_DT
			 , X.OCCRRNC_BEGIN_DT
			 , X.OCCRRNC_END_DT
			 , X.OCCRRNC_ADDR
			 , X.INV_PROVIS_NM
			 , X.PROGRS_STTUS_NM
			 , X.CHARGER_NM
			 , X.CHARGER_DEPT_NM
			 , X.VIOLT_NM
			 , X.SUFRER_NM
			 , TO_CHAR(TO_DATE(X.PRSCT_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS PRSCT_DE
			 , X.TRGTER_NM
			 , X.TRGTER_ENG_NM
			 , X.TRGTER_RRN
			 , X.TRGTER_SN
			 , X.SEXDSTN_CD
			 , X.OCCP_NM
			 , X.TRGTER_CPRN
			 , X.TRGTER_CRN
			 , X.DWLSIT_ADDR
		     , X.ATTRACT_PLACE
		     , X.RSL_DT
		     , FN_CNVR_NO(X.CCDRC_NO) AS CCDRC_NO
		     , X.TRN_OPINION_NM
		     , X.TRN_VIOLT_NM
		     , FN_CNVR_NO(X.TRN_NO) AS TRN_NO
		     , TO_CHAR(TO_DATE(X.TRN_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS TRN_DE
             , X.PRSEC_DSPS_DE      --검사처분일
		     , X.PRSEC_DSPS_OUTLINE --검사처분 요지
		     , X.JUDMN_DE           --판결처분일
		     , X.JUDMN_OUTLINE      --판결요지 
		     , X.RM                 --비고
		     , X.OCCRRNC_ZERO_NO --발생 원표 번호
	  		 , X.ARREST_ZERO_NO --검거 원표 번호
     		 , X.SUSPCT_ZERO_NO --피의자 원표 번호
		FROM
		(
			SELECT A.*,
			COUNT(*) OVER() AS TOT_CNT,
			<isNotEmpty property="dataField">
				<isNotEmpty property="sortType">
					ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
				</isNotEmpty>
			</isNotEmpty>
			<isEmpty property="dataField">		
				DENSE_RANK() OVER(PARTITION BY A.CASE_NO ORDER BY A.CASE_NO, A.TRGTER_SN ASC) RN
			</isEmpty>			
			FROM
			(
				SELECT
				RT.RC_NO,
				RT.ITIV_NO,
				RT.CASE_NO,
				RT.RC_SE_CD,
				RT.INV_PROVIS_CD,
				RT.PROGRS_STTUS_CD,
				RT.OCCRRNC_ZIP,
				RT.OCCRRNC_ADDR,
			    RT.CHARGER_ID,
			    RT.CHARGER_DEPT_CD,
				RT.PRSCT_DE,
                RTT.TRGTER_SN,
                RTT.TRGTER_CL_CD,
                RTT.TRGTER_NM,
                RTT.TRGTER_ENG_NM,
                RTT.SEXDSTN_CD,
                DGUARD.DECRYPT('TBL','ENC',RTT.TRGTER_RRN) AS TRGTER_RRN,
                RTT.OCCP_CD,
                RTT.TRGTER_CPRN,
                RTT.TRGTER_CRN,
                RTT.DWLSIT_ZIP,
                RTT.DWLSIT_ADDR,                
                TO_CHAR(RT.RC_DT, 'YYYY. MM. DD. HH24:MI') AS RC_DT,
				TO_CHAR(RT.OCCRRNC_BEGIN_DT, 'YYYY. MM. DD. HH24:MI') AS OCCRRNC_BEGIN_DT,
				TO_CHAR(RT.OCCRRNC_END_DT, 'YYYY. MM. DD. HH24:MI') AS OCCRRNC_END_DT,
                FN_CD_NM(RT.INV_PROVIS_CD) AS INV_PROVIS_NM,
				FN_CD_NM(RT.PROGRS_STTUS_CD) AS PROGRS_STTUS_NM,
				FN_USER_NM(RT.CHARGER_ID) AS CHARGER_NM,
				FN_DEPT_NM(RT.CHARGER_DEPT_CD) AS CHARGER_DEPT_NM,
				FN_RC_VIOLT_UPPER_NMS(RT.RC_NO) AS VIOLT_NM,
				FN_RC_TRGTER_NM(RT.RC_NO,'00698') AS SUFRER_NM,				
				FN_CD_NM(RTT.OCCP_CD) AS OCCP_NM,
				(
					SELECT LISTAGG(IPA.ATTRACT_PLACE,',') WITHIN GROUP (ORDER BY IPA.RC_NO, IPA.TRGTER_SN)
					FROM INV_PRSCT_ARRST IPA
					WHERE IPA.RC_NO = RTT.RC_NO AND IPA.TRGTER_SN = RTT.TRGTER_SN AND IPA.USE_YN = 'Y'
				) AS ATTRACT_PLACE,
				(
					SELECT LISTAGG(IPA.RSL_DT||'('|| FN_CD_NM(IPA.RSL_RESN_CD) ||')',',') WITHIN GROUP (ORDER BY IPA.RC_NO, IPA.TRGTER_SN)
					FROM INV_PRSCT_ARRST IPA
					WHERE IPA.RC_NO = RTT.RC_NO AND IPA.TRGTER_SN = RTT.TRGTER_SN AND IPA.USE_YN = 'Y' AND IPA.RSL_DT IS NOT NULL
				) AS RSL_DT,
				(
					SELECT REGEXP_REPLACE(LISTAGG(ICI.CCDRC_NO,',') WITHIN GROUP (ORDER BY ICI.CCDRC_NO),'([^,]+)(,\1)+', '\1')
					FROM INV_CCDRC_TRGTER ICI
					WHERE ICI.RC_NO = RTT.RC_NO AND ICI.TRGTER_SN = RTT.TRGTER_SN
				) AS CCDRC_NO,
				(
					SELECT LISTAGG(FN_CD_NM(TV.TRN_OPINION_CD),',') WITHIN GROUP (ORDER BY TV.TRN_NO)
					FROM TRN_VIOLT TV
					WHERE TV.RC_NO = RTT.RC_NO AND TV.TRGTER_SN = RTT.TRGTER_SN
				) AS TRN_OPINION_NM,
				(
					SELECT REGEXP_REPLACE(LISTAGG(FN_VIOLT_NM(TV.VIOLT_CD),',') WITHIN GROUP (ORDER BY TV.VIOLT_CD),'([^,]+)(,\1)+', '\1')
					FROM TRN_VIOLT TV
					WHERE TV.RC_NO = RTT.RC_NO AND TV.TRGTER_SN = RTT.TRGTER_SN
				) AS TRN_VIOLT_NM,
				TC.TRN_NO,
				TC.TRN_DE
			  , TS.PRSEC_DSPS_DE      --검사처분일
			  , TS.PRSEC_DSPS_OUTLINE --검사처분 요지
			  , TS.JUDMN_DE           --판결처분일
			  , TS.JUDMN_OUTLINE      --판결요지 
			  , TS.RM                 --비고
				/*NVL((SELECT MAX(TC.TRN_DE) FROM TRN_CASE TC WHERE TC.RC_NO = RT.RC_NO AND TC.USE_YN = 'Y'),'') AS TRN_DE,*/
			  /* 
			  	2022.01.14
			  	범죄사건부에 발생사건표, 검거사건표, 피의자표 추가
			  	김지만 수사관 요청
			  */
			  , TC.OCCRRNC_ZERO_NO --발생 원표 번호
	  		  , TC.ARREST_ZERO_NO --검거 원표 번호
     		  , TS.SUSPCT_ZERO_NO --피의자 원표 번호            
				FROM RC_TMPR RT
				INNER JOIN RC_TMPR_TRGTER RTT ON RT.RC_NO = RTT.RC_NO AND RTT.USE_YN = 'Y' AND RTT.TRGTER_SE_CD = '00697'
				LEFT OUTER JOIN TRN_SUSPCT TS ON TS.RC_NO = RTT.RC_NO AND TS.TRGTER_SN = RTT.TRGTER_SN AND TS.USE_YN = 'Y'
				LEFT OUTER JOIN TRN_CASE TC ON TC.TRN_NO = TS.TRN_NO AND TC.USE_YN = 'Y'
				WHERE RT.USE_YN = 'Y'
				AND RT.CASE_NO IS NOT NULL
				<isNotEmpty property="searchTrgterNm" >
					AND RTT.TRGTER_NM = #searchTrgterNm#
				</isNotEmpty>
				<isNotEmpty property="searchChager" >
					AND RT.CHARGER_ID = #searchChager#
				</isNotEmpty>
				<isNotEmpty property="searchDeptCd" >
					AND RT.CHARGER_DEPT_CD IN (
						SELECT DC.DEPT_CD
						FROM CMN_DEPT_CD DC
						WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
						START WITH DC.DEPT_CD = #searchDeptCd#
						CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
					)
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoStart" >
					AND RT.CASE_NO <![CDATA[ >= ]]> #searchCaseNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoEnd" >
					AND RT.CASE_NO <![CDATA[ <= ]]> #searchCaseNoEnd#
				</isNotEmpty>

				<isNotEmpty property="searchPrsctDeStart" >
					AND RT.PRSCT_DE <![CDATA[ >= ]]> REPLACE(#searchPrsctDeStart#,'-','')
				</isNotEmpty>
				<isNotEmpty property="searchPrsctDeEnd" >
					AND RT.PRSCT_DE <![CDATA[ <= ]]> REPLACE(#searchPrsctDeEnd#,'-','')
				</isNotEmpty>
				
				/*
					2022.01.27
					coded by dgkim
					대상자 순번 정렬방식 추가
					김지만 수사관 요청
				*/
				ORDER BY RT.CASE_NO ASC, RTT.TRGTER_SN ASC
			) A
		) X		
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
	</select>

	<select id="selectItivCaseList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
				X.RN,
				X.TOT_CNT,
				X.RC_NO,
				X.ITIV_NO,
				X.CASE_NO,
				X.RC_DT,
				X.ITIV_DT,
				X.OUTSET_RESN,
				X.ITIV_RESULT_NM,
				X.ITIV_CN,
				X.RESULT_DT,
			    X.CHARGER_NM,
			    X.CHARGER_DEPT_NM,
		        X.TRGTER_NM,
		        X.TRGTER_RRN,
		        X.DWLSIT_ADDR,
		        X.ADRES_ADDR,				--주소지
		        X.ITIV_RESULT_CD,
		        X.ED_DSPS_CD, 				--종결 처분 코드
		        X.ED_DSPS_NM, --종결 처분 코드
		        X.PRSCT_DE, --입건일자
		        X.ITIV_RESULT_REPORT_DT, --내사결과보고일시
		        X.CMNDER --내사 지휘자
		 FROM
		     (
			SELECT A.*,			 
			COUNT(*) OVER() AS TOT_CNT,
			<isNotEmpty property="dataField">
				<isNotEmpty property="sortType">
					ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
				</isNotEmpty>
			</isNotEmpty>
			<isEmpty property="dataField">		
				ROW_NUMBER() OVER(ORDER BY A.ITIV_NO, A.RC_NO) RN
			</isEmpty>
			FROM
			(
				SELECT
				RT.RC_NO,
				RT.ITIV_NO,
				RT.CASE_NO,
				MAX(RIO.OUTSET_RESN) AS OUTSET_RESN,
                MAX(RIR.ITIV_RESULT_CD) AS ITIV_RESULT_CD,
                MAX(RIR.ITIV_CN) AS ITIV_CN,
                MAX(RTT.TRGTER_NM) KEEP(DENSE_RANK FIRST ORDER BY RTT.TRGTER_SN ASC) || (CASE WHEN COUNT(DISTINCT(RTT.TRGTER_SN)) > 1 THEN ' 외 '||(COUNT(DISTINCT(RTT.TRGTER_SN))-1) END) AS TRGTER_NM,
                MAX(DGUARD.DECRYPT('TBL','ENC',RTT.TRGTER_RRN)) KEEP(DENSE_RANK FIRST ORDER BY RTT.TRGTER_SN ASC) AS TRGTER_RRN,
                MAX(RTT.DWLSIT_ADDR) KEEP(DENSE_RANK FIRST ORDER BY RTT.TRGTER_SN ASC) AS DWLSIT_ADDR,
                MAX(RTT.ADRES_ADDR) KEEP(DENSE_RANK FIRST ORDER BY RTT.TRGTER_SN ASC) AS ADRES_ADDR, -- 주소지
                TO_CHAR(MAX(RT.RC_DT), 'YYYY-MM-DD') AS RC_DT,
				TO_CHAR(MAX(RIO.OUTSET_REPORT_DT), 'YYYY-MM-DD') AS ITIV_DT,--TO_CHAR(MAX(RIO.OUTSET_DT), 'YYYY-MM-DD') AS ITIV_DT,
				FN_CD_NM(MAX(RIR.ITIV_RESULT_CD)) AS ITIV_RESULT_NM,
				TO_CHAR(MAX(RIR.WRITNG_DT), 'YYYY-MM-DD') AS RESULT_DT,
				FN_USER_NM(MAX(RT.CHARGER_ID)) AS CHARGER_NM,
				FN_DEPT_NM(MAX(RT.CHARGER_DEPT_CD)) AS CHARGER_DEPT_NM,
				MAX(RIR.ED_DSPS_CD) AS ED_DSPS_CD, --종결 처분 코드
				FN_CD_NM(MAX(RIR.ED_DSPS_CD)) AS ED_DSPS_NM, 			--종결 처분 코드
				MAX(RT.PRSCT_DE) AS PRSCT_DE, --입건일자
				TO_CHAR(MAX(RIR.ITIV_RESULT_REPORT_DT), 'YYYY-MM-DD') AS ITIV_RESULT_REPORT_DT, --내사결과보고일시
				MAX(RT.CMNDER) AS CMNDER --내사 지휘자
				FROM RC_TMPR RT
                INNER JOIN RC_TMPR_TRGTER RTT ON RT.RC_NO = RTT.RC_NO
                	AND RTT.TRGTER_SE_CD IN ( SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'suspct-Group' ) /*피의자 그룹*/
				LEFT JOIN RC_ITIV_OUTSET RIO ON RT.RC_NO = RIO.RC_NO
				LEFT JOIN RC_ITIV_RESULT RIR ON RT.ITIV_NO = RIR.ITIV_NO
				WHERE RT.USE_YN = 'Y'
				  AND RT.ITIV_NO IS NOT NULL
				<isNotEmpty property="searchTrgterNm" >
					AND RT.RC_NO IN (
						SELECT TT.RC_NO
						FROM RC_TMPR_TRGTER TT
						WHERE TT.TRGTER_NM = #searchTrgterNm#
						<isNotEmpty property="searchTrgterCl" prepend="AND">
							TT.TRGTER_SE_CD = #searchTrgterCl#
						</isNotEmpty>
					)
				</isNotEmpty>
				<isNotEmpty property="searchChager" >
					AND RT.CHARGER_ID = #searchChager#
				</isNotEmpty>
				<isNotEmpty property="searchDeptCd" >
					AND RT.CHARGER_DEPT_CD IN (
						SELECT DC.DEPT_CD
						FROM CMN_DEPT_CD DC
						WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
						START WITH DC.DEPT_CD = #searchDeptCd#
						CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
					)
				</isNotEmpty>
				<isNotEmpty property="searchRcNoStart" >
					AND RT.RC_NO <![CDATA[ >= ]]> #searchRcNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchRcNoEnd" >
					AND RT.RC_NO <![CDATA[ <= ]]> #searchRcNoEnd#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoStart" >
					AND RT.CASE_NO <![CDATA[ >= ]]> #searchCaseNoStart#
				</isNotEmpty>
				<isNotEmpty property="searchCaseNoEnd" >
					AND RT.CASE_NO <![CDATA[ <= ]]> #searchCaseNoEnd#
				</isNotEmpty>

				<isNotEmpty property="searchPrsctDeStart" >
						AND RT.WRITNG_DT <![CDATA[ >= ]]> TO_DATE(REPLACE(#searchPrsctDeStart#,'-',''),'YYYYMMDD')
				</isNotEmpty>
				<isNotEmpty property="searchPrsctDeEnd" >
					AND RT.WRITNG_DT <![CDATA[ <= ]]> TO_DATE(REPLACE(#searchPrsctDeEnd#,'-',''),'YYYYMMDD') + 0.999999
				</isNotEmpty>
				GROUP BY RT.RC_NO, RT.ITIV_NO, RT.CASE_NO, RIR.ED_DSPS_CD
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>



	<select id="selectCaseSttusSum" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT NVL(SUM(CASE WHEN A.PROGRS_STTUS_CD = '02103' THEN 1
			 			    WHEN A.PROGRS_STTUS_CD = '02131' THEN 1
	            			WHEN A.PROGRS_STTUS_CD = '02132' THEN 1
	            			WHEN A.PROGRS_STTUS_CD = '02141' THEN 1
	            			WHEN A.PROGRS_STTUS_CD = '02143' THEN 1	ELSE 0 END),0) AS ST_CNT1	--수사중
			 , NVL(SUM(CASE WHEN A.PROGRS_STTUS_CD = '02121' THEN 1 ELSE 0 END),0) AS ST_CNT2	--수사지휘건의
		  	 , NVL(SUM(CASE WHEN A.PROGRS_STTUS_CD = '02122' THEN 1 ELSE 0 END),0) AS ST_CNT3	--송치준비중
			 , NVL(SUM(CASE WHEN A.PROGRS_STTUS_CD = '02123' THEN 1 ELSE 0 END),0) AS ST_CNT4	--송치완료
		  FROM RC_TMPR A
		 WHERE A.USE_YN = 'Y'
		   AND A.CHARGER_DEPT_CD = #dept_cd#
		   AND A.CHARGER_ID = #esntl_id#
	</select>

	<select id="selectRcCaseSttusSum" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT NVL(SUM(CASE WHEN A.PROGRS_STTUS_CD = '02101' THEN 1
					  	    WHEN A.PROGRS_STTUS_CD = '02102' THEN 1
	            			WHEN A.PROGRS_STTUS_CD = '02104' THEN 1 ELSE 0 END),0) AS ST_CNT0	--사겁접수
		  FROM RC_TMPR A
		 WHERE A.USE_YN = 'Y'
		   AND A.WRITNG_DEPT_CD = #dept_cd#
		   AND A.WRITNG_ID = #esntl_id#
	</select>
	
	<update id="updateCrimeCaseSuspct" parameterClass="java.util.HashMap">
	<![CDATA[
		UPDATE TRN_SUSPCT
		   SET PRSEC_DSPS_DE = #PRSEC_DSPS_DE#
		     , PRSEC_DSPS_OUTLINE = #PRSEC_DSPS_OUTLINE#
		     , JUDMN_DE = #JUDMN_DE#
		     , JUDMN_OUTLINE = #JUDMN_OUTLINE#
		     , RM = #RM#
		     , UPDT_ID = #UPDT_ID#
		     , UPDT_DT = SYSDATE
		 WHERE TRN_NO = #TRN_NO#
		   AND RC_NO  = #RC_NO#
		   AND TRGTER_SN = #TRGTER_SN#
	]]>
	</update>
	
	<!-- 
		2021.07.20
		coded by dgkim
		사건대장 > 내사사건부 개편으로 인한 지휘자 칼럼 추가 및 업데이트 기능 추가
		김지만 수사관 요청
	 -->
	<update id="updateCmnder" parameterClass="java.util.HashMap">
		UPDATE RC_TMPR
			SET CMNDER = #CMNDER# --지휘자
			, UPDT_ID = #esntl_id#
			, UPDT_DT = SYSDATE
		WHERE RC_NO = #RC_NO#
	</update>
	
	<!-- 
		2021.08.19
		coded by dgkim
		통신사실 확인자료제공 요청허가 신청부
		신규 문서 서식
	 -->
	<select id="selectVdecRequstPrmisnReqstList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.PRMISN_PROGRS_NO, A.CASE_NO, A.TRGTER_SN) AS RN
				</isEmpty>
			FROM
				(
					SELECT 
						icp.RC_NO --접수번호
						, icp.PRMISN_PROGRS_NO --허가 진행 번호
						, (SELECT FN_CNVR_NO(CASE_NO) FROM RC_TMPR WHERE RC_NO = icp.RC_NO) AS CASE_NO --사건번호
						, rtt.TRGTER_SN --대상자 일련번호
						, rtt.TRGTER_NM --성명
						, DGUARD.DECRYPT('TBL', 'ENC', rtt.TRGTER_RRN) AS TRGTER_RRN --주민번호
						, FN_CD_NM(rtt.OCCP_CD) AS OCCP_NM --직업
						, FN_CD_NM(PRMISN_SE_CD) AS PRMISN_SE_NM --종류
						, FN_RC_VIOLT_ROOT_NM (icp.RC_NO) AS VIOLT_NM --죄명
						, icp.DTA_SCOPE --대상 및 범위
						, '' AS EMERGENCY_DE --긴급으로 자료 제공받은 일시
						, TO_CHAR(TO_DATE(icp.REQST_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS REQST_DE--신청일일시
						, TO_CHAR(TO_DATE(icp.ISUE_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS ISUE_DE -- 발부일시
						, '' AS RECEIPT --수령연월일
						, '' AS RECIPIENT --수령자 직급, 성명
						, icp.RETURN_DE--검찰반환연월일
						, '' AS NOTE --비고
					FROM INV_COMMN_PRMISN icp
						INNER JOIN RC_TMPR_TRGTER rtt
						ON icp.RC_NO = rtt.RC_NO AND icp.TRGTER_SN = rtt.TRGTER_SN
					WHERE icp.USE_YN = 'Y'
						<isNotEmpty property="trgter_nm">
							AND rtt.TRGTER_NM LIKE '%' || #trgter_nm# || '%'
						</isNotEmpty>
						
						<isNotEmpty property="chager">
							AND icp.RC_NO IN(
								SELECT RC_NO FROM RC_TMPR WHERE CHARGER_ID = #chager#
							)
						</isNotEmpty>
						
						<isNotEmpty property="dept_cd">
							AND icp.RC_NO IN(
								SELECT RC_NO FROM RC_TMPR WHERE CHARGER_DEPT_CD IN(
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							)
						</isNotEmpty>
				) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		
		ORDER BY RN ASC
	</select>
	
	<!-- 
		2021.09.14
		coded by dgkim
		피의자 등 소재발견처리부
		신규 문서 서식
	 -->
	<select id="selectSuspctMatrDscvryList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,
				COUNT(*) OVER() AS TOT_CNT,
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						ROW_NUMBER() OVER(ORDER BY A.$dataField$ $sortType$ NULLS LAST) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					ROW_NUMBER() OVER(ORDER BY A.CASE_NO ASC, A.TRGTER_SN ASC) AS RN
				</isEmpty>
			FROM
				(
					SELECT T.* FROM
					(
						(/* 기소중지 */
							SELECT
								T.RC_NO, --접수번호
								TT.TRGTER_NM, --피의자 또는 참고인
								TT.TRGTER_SN, --대상자 일련번호
								I.DSCVRY_DE, --소재발견일자
								I.DSCVRY_RESN, --소재발견사유
								I.DSCVRY_REPORT_DE, --소재발견 보고일
								FN_RC_VIOLT_ROOT_NM (RT.RC_NO) AS VIOLT_NM, --죄명
								I.SRCCRM_RELIS_DE, --수배해제일자
								T.CASE_NO, --재기전 사건번호
								(SELECT MAX(B.TRN_DE) FROM TRN_CASE B WHERE RC_NO = T.RC_NO AND B.USE_YN = 'Y') AS TRN_DE, --송치일
								FN_USER_NM(T.CHARGER_ID) AS CHARGER_NM --담당자
								--비고
							FROM (
								SELECT RC_NO FROM (
									SELECT A.RC_NO FROM RC_TMPR A
									WHERE A.USE_YN = 'Y'
										AND A.PROGRS_STTUS_CD = '02124'            /*기소중지*/
										AND A.RC_NO IN (
											SELECT DISTINCT TT.RC_NO
											FROM RC_TMPR_TRGTER TT
											JOIN RC_TMPR RR ON TT.RC_NO = RR.RC_NO AND RR.USE_YN = 'Y' AND RR.PROGRS_STTUS_CD = '02124'
											WHERE TT.USE_YN = 'Y'
												AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'suspct-Group' )         /*피의자*/
									)
									UNION ALL
									SELECT B.RC_NO FROM INV_STPRSC B
									JOIN RC_TMPR C ON B.RC_NO = C.RC_NO
									WHERE C.USE_YN = 'Y'
								) GROUP BY RC_NO
							) RT
							JOIN RC_TMPR T ON RT.RC_NO = T.RC_NO
							JOIN (
								SELECT
									CC.RC_NO,
									CC.TRGTER_SN,
									RT.TRGTER_NM,
									MAX(CC.TRN_NO) AS TRN_NO,
									MAX(D.TRN_DE) KEEP(DENSE_RANK FIRST ORDER BY CC.TRN_NO DESC) AS TRN_DE
									FROM TRN_VIOLT CC
									JOIN TRN_CASE D ON D.TRN_NO = CC.TRN_NO AND D.USE_YN = 'Y'
									JOIN RC_TMPR CT ON CC.RC_NO = CT.RC_NO
									JOIN RC_TMPR_TRGTER RT ON CT.RC_NO = RT.RC_NO AND CC.TRGTER_SN = RT.TRGTER_SN AND RT.USE_YN = 'Y'
								WHERE CC.USE_YN = 'Y'
									AND D.ED_YN = 'Y'                        /*종결여부*/
									AND CC.TRN_OPINION_CD = '01367'        /*피의자소재불명*/
									AND RT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'suspct-Group' ) /*피의자 그룹*/
								GROUP BY CC.RC_NO, CC.TRGTER_SN, RT.TRGTER_NM
							) TT ON T.RC_NO = TT.RC_NO
							LEFT JOIN INV_STPRSC_DSCVRY I ON TT.RC_NO = I.RC_NO AND TT.TRGTER_SN = I.TRGTER_SN
							LEFT JOIN INV_STPRSC_REPORT B ON TT.RC_NO = B.RC_NO AND TT.TRGTER_SN = B.TRGTER_SN
							WHERE T.USE_YN = 'Y'
						)
						UNION
						(/* 잠고인중지 */
							SELECT
								T.RC_NO, --접수번호
								TT.TRGTER_NM, --피의자 또는 참고인
								TT.TRGTER_SN, --대상자 일련번호
								I.DSCVRY_DE, --소재발견일자
								I.DSCVRY_RESN, --소재발견사유
								I.DSCVRY_REPORT_DE, --소재발견 보고일
								FN_RC_VIOLT_ROOT_NM (T.RC_NO) AS VIOLT_NM, --죄명
								'' AS SRCCRM_RELIS_DE,--수배해제일자
								T.CASE_NO,--재기전 사건번호
								(SELECT MAX(B.TRN_DE) FROM TRN_CASE B WHERE RC_NO = T.RC_NO AND B.USE_YN = 'Y') AS TRN_DE, --송치일
								FN_USER_NM(T.CHARGER_ID) AS CHARGER_NM --담당자
								--비고
							FROM (
								SELECT RC_NO FROM (
									SELECT A.RC_NO FROM RC_TMPR A
									WHERE A.USE_YN = 'Y'
										AND A.PROGRS_STTUS_CD = '02125' /*참고인중지*/
										AND A.RC_NO IN (
											SELECT DISTINCT TT.RC_NO
											FROM RC_TMPR_TRGTER TT
											JOIN RC_TMPR RR ON TT.RC_NO = RR.RC_NO AND RR.USE_YN = 'Y' AND RR.PROGRS_STTUS_CD = '02125' /*참고인중지*/
											WHERE TT.USE_YN = 'Y'
												AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'accs-Group' ) /*참고인 그룹*/
										)
									UNION ALL
									SELECT B.RC_NO FROM INV_REFESTPGE B
									JOIN RC_TMPR C ON B.RC_NO = C.RC_NO
									WHERE C.USE_YN = 'Y'
								) GROUP BY RC_NO
							) RT
							JOIN RC_TMPR T ON RT.RC_NO = T.RC_NO
							JOIN RC_TMPR_TRGTER TT ON T.RC_NO = TT.RC_NO AND TT.USE_YN = 'Y'
								AND TT.TRGTER_SE_CD IN (SELECT CC.ESNTL_CD FROM CMN_CD CC WHERE CC.UPPER_CD = '00102'  AND CC.CD_DC = 'accs-Group' )
								LEFT JOIN INV_REFE_DSCVRY I ON TT.RC_NO = I.RC_NO AND TT.TRGTER_SN = I.TRGTER_SN
								LEFT JOIN INV_REFE_REPORT B ON TT.RC_NO = B.RC_NO AND TT.TRGTER_SN = B.TRGTER_SN
							WHERE T.USE_YN = 'Y'
						)
					) T
					<dynamic prepend="WHERE">
						<isNotEmpty property="chager" prepend="AND">
							T.RC_NO IN(
								SELECT RC_NO FROM RC_TMPR WHERE CHARGER_ID = #chager#
							)
						</isNotEmpty>
						
						<isNotEmpty property="dept_cd" prepend="AND">
							T.RC_NO IN(
								SELECT RC_NO FROM RC_TMPR WHERE CHARGER_DEPT_CD IN(
									SELECT DC.DEPT_CD
									FROM CMN_DEPT_CD DC
									WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
									START WITH DC.DEPT_CD = #dept_cd#
									CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
								)
							)
						</isNotEmpty>
						
						<isNotEmpty property="trgter_nm" prepend="AND">
							T.TRGTER_NM LIKE '%' || #trgter_nm# || '%'
						</isNotEmpty>
					</dynamic>
				) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		
		ORDER BY RN ASC
	</select>
	
	<!-- 
		2021.10.05
		coded by dgkim
		몰수 부대보전 신청부
		신규 문서 서식
		(기존 압수수색검증영장신청부 그대로 사용하여 구현)
	 -->
	<select id="selectCnfscMrnPresvReqstList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.ZRLONG_REQST_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.ZRLONG_REQST_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						/*DENSE_RANK() OVER (ORDER BY A.ZRLONG_REQST_NO) AS RN*/
						A.ZRLONG_REQST_NO,
						R.ZRLONG_NO,
						D.CASE_NO,
						C.RC_NO,
						A.REQST_DE,
						FN_CD_NM(NVL(E.RSPOFC_CD, E.CLSF_CD)) || ' ' || E.USER_NM AS REQST_NM,
						C.TRGTER_NM,
						DGUARD.DECRYPT('TBL','ENC',C.TRGTER_RRN) AS TRGTER_RRN,
						FN_CD_NM(C.OCCP_CD) AS OCCP_NM,
						C.DWLSIT_ADDR,
						FN_RC_VIOLT_ROOT_NM (A.RC_NO) AS VIOLT_ROOT_NM,
						DECODE(R.DSMSSL_INSTT_CD, 'P', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) AS PP_DSMSSL_INSTT,         	/*검찰사-검사*/
						DECODE(R.DSMSSL_INSTT_CD, 'C', TO_CHAR(R.EXCUT_DT,'YYYY.MM.DD HH24:MI')) AS CC_DSMSSL_INSTT,         	/*법원-판사*/
						TO_CHAR(R.ISUE_DT,'YYYY.MM.DD HH24:MI') AS ISUE_DT,
						TO_CHAR(NVL(R.VALID_DT,A.VALID_DT),'YYYY-MM-DD') AS VALID_DT
						/*석방일시*/
						/*석방장소*/
						/*처리결과*/
					FROM INV_SZURE_REQST A
					LEFT JOIN INV_SZURE_APPLCNT B ON A.ZRLONG_REQST_NO = B.ZRLONG_REQST_NO
					LEFT JOIN RC_TMPR_TRGTER C ON B.RC_NO = C.RC_NO AND B.TRGTER_SN = C.TRGTER_SN
					LEFT JOIN INV_SZURE_RESULT R ON A.ZRLONG_REQST_NO = R.ZRLONG_REQST_NO
					LEFT JOIN RC_TMPR D ON A.RC_NO = D.RC_NO
					LEFT JOIN CMN_USER E ON A.WRITNG_ID = E.ESNTL_ID
					WHERE C.USE_YN = 'Y'
						AND NVL(R.ZRLONG_NO,0) = (SELECT NVL(MAX(RR.ZRLONG_NO),0) FROM INV_SZURE_RESULT RR WHERE RR.ZRLONG_REQST_NO = A.ZRLONG_REQST_NO)
					<isNotEmpty property="zrlong_se_cd" >
						AND A.ZRLONG_SE_CD = #zrlong_se_cd#
					</isNotEmpty>
					<isNotEmpty property="trgter_nm" >
						AND C.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND D.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND D.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
					<isNotEmpty property="rc_no1" >
						AND C.RC_NO LIKE #rc_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="rc_no2" >
						AND C.RC_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="rc_no3" >
						AND C.RC_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#rc_no3#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no1" >
						AND C.CASE_NO LIKE #case_no1# || '%'
					</isNotEmpty>
					<isNotEmpty property="case_no2" >
						AND C.CASE_NO <![CDATA[ >= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no2#,6,'0'))
					</isNotEmpty>
					<isNotEmpty property="case_no3" >
						AND C.CASE_NO <![CDATA[ <= ]]> (SUBSTR(C.RC_NO,0,5)||LPAD(#case_no3#,6,'0'))
					</isNotEmpty>

					<isNotEmpty property="prsct_de1" >
						AND A.REQST_DE <![CDATA[ >= ]]> REPLACE(#prsct_de1#,'-','')
					</isNotEmpty>
					<isNotEmpty property="prsct_de2" >
						AND A.REQST_DE <![CDATA[ <= ]]> REPLACE(#prsct_de2#,'-','')
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>
	
	<!-- 
		2021.10.05
		coded by dgkim
		송ㆍ수신이 완료된 전기통신에 대한 압수ㆍ수색ㆍ검증 집행사실 통지부
		신규 문서 서식
	 -->
	<select id="selectTrsmrcvComptElcncVrifyExcutFactNticeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.PRMISN_PROGRS_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.PRMISN_PROGRS_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT PRMISN_PROGRS_NO
						, PRMISN_SE_CD
						, COMMN_BSNM
						, TO_CHAR(TO_DATE(REQST_DE,'YYYYMMDD'),'YYYY-MM-DD') AS REQST_DE
						, DTA_SCOPE
						, REQUST_RESN
						, SBSCRBER_RELATE
						, RERQEST_RESN
						, NNPMSNPC_RESN
						, TO_CHAR(EXCUT_DT,'YYYY-MM-DD')     AS EXCUT_DT
						, TO_CHAR(EXCUT_DT,'HH24')          AS EXCUT_DT2
						, TO_CHAR(EXCUT_DT,'MI')              AS EXCUT_DT3
						, A.DOC_ID
						, A.FILE_ID
						, A.RC_NO
						, B.CASE_NO
						, A.TRGTER_SN
						, TRGTER_NM
						, DGUARD.DECRYPT('TBL','ENC',C.TRGTER_RRN) AS TRGTER_RRN
						, ADRES_ADDR
						, FN_CD_NM(OCCP_CD) OCCP_CD_NM
						, FN_EXMN_NM(B.CMPTNC_EXMN_CD) CMPTNC_EXMN_NM
						, FN_USER_NM(B.CHARGER_ID) ALOT_USER_NM
						, FN_RC_VIOLT_UPPER_NMS(A.RC_NO) VIOLT_NM
						, REQST_RESULT_CD
						, PRMISN_NO
						, TO_CHAR(TO_DATE(PRMISN_RECPT_DE,'YYYYMMDD'),'YYYY-MM-DD') AS PRMISN_RECPT_DE
						, TO_CHAR(TO_DATE(ISUE_DE,'YYYYMMDD'),'YYYY-MM-DD') AS ISUE_DE
						, DSMSSL_SE_CD
						, TO_CHAR(TO_DATE(DSMSSL_DE,'YYYYMMDD'),'YYYY-MM-DD') AS DSMSSL_DE
						, DSMSSL_RESN
						, TO_CHAR(TO_DATE(RETURN_DE,'YYYYMMDD'),'YYYY-MM-DD') AS RETURN_DE
						, RETURN_RESN
						, REREQST_YN
						, ORIGNL_PROGRS_NO
						, A.DTA_SCOPE_ENCLSR_YN
						, A.REQUST_RESN_ENCLSR_YN
						, A.SBSCRBER_RELATE_ENCLSR_YN
						, A.RERQEST_RESN_ENCLSR_YN
						, A.NNPMSNPC_RESN_ENCLSR_YN
						, FN_CD_NM(REQST_RESULT_CD) AS REQST_RESULT_NM
					FROM INV_COMMN_PRMISN A
						, RC_TMPR_TRGTER C
						, RC_TMPR B
					WHERE A.RC_NO = C.RC_NO
						AND A.TRGTER_SN = C.TRGTER_SN
						AND A.USE_YN = 'Y'
						AND B.USE_YN = 'Y'
						AND A.RC_NO = B.RC_NO
					
					<isNotEmpty property="trgter_nm" >
						AND C.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND B.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND B.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	</select>
	
	<!-- 
		2021.10.18
		coded by dgkim
		통신사실 확인자료제공 요청 집행대장
		신규 문서 서식
	 -->
	 <select id="selectVdecRequstExcutList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.PRMISN_PROGRS_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.PRMISN_PROGRS_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						C.RC_NO --접수번호
						, FN_CNVR_NO(A.PRMISN_PROGRS_NO) AS PRMISN_PROGRS_NO --집행번호
						, FN_CNVR_NO(A.PRMISN_NO) AS PRMISN_NO --허가 번호
						, B.TRGTER_NM --대상자성명
						, FN_CD_NM(C.PROGRS_STTUS_CD) AS PROGRS_STTUS_NM --진행상태
						, FN_CD_NM(C.INV_PROVIS_CD) AS INV_PROVIS_NM -- 수사단서
						, TO_CHAR(A.EXCUT_DT, 'YYYY-MM-DD HH24:MI') AS EXCUT_DT --집행일시
						, '' AS BIGO --비고
					FROM INV_COMMN_PRMISN A
						LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
						LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
						LEFT JOIN CMN_USER UR ON C.CHARGER_ID = UR.ESNTL_ID
					WHERE A.USE_YN = 'Y'
					
					<isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	 </select>
	 
	 <!-- 
		2021.10.18
		coded by dgkim
		통신사실 확인자료 회신대장
		신규 문서 서식
	 -->
	 <select id="selectVdecRplyRegstrList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.REQST_DE) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.REQST_DE) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						C.RC_NO --접수번호
						, TO_CHAR(TO_DATE(A.REQST_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS REQST_DE --요청일자
						, FN_USER_NM(C.CHARGER_ID) AS CHARGER_NM --요청자
						, B.TRGTER_NM --대상자성명
						, A.DTA_SCOPE --제공받은 자료의 범위
						, TO_CHAR(TO_DATE(A.PRMISN_RECPT_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS PRMISN_RECPT_DE --회신일자
						, '' AS BIGO --비고	
					FROM INV_COMMN_PRMISN A
						LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
						LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
						LEFT JOIN CMN_USER UR ON C.CHARGER_ID = UR.ESNTL_ID
					WHERE A.USE_YN = 'Y'

					<isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	 </select>
	 
	 <!-- 
	 	2021.10.18
		coded by dgkim
		통신사실 확인자료제공 요청 집행사실 통지부
		신규 문서 서식
	  -->
	 <select id="selectVdecRequstExcutFactList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.PRMISN_PROGRS_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.PRMISN_PROGRS_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						C.RC_NO --접수번호
						, FN_CNVR_NO(A.PRMISN_PROGRS_NO) AS PRMISN_PROGRS_NO --허가서 번호
						, B.TRGTER_NM --대상자성명
						, FN_CD_NM(UR.CLSF_CD) || ' / ' || FN_USER_NM(C.CHARGER_ID) AS CHARGER_NM --집행자의 직급 및 성명
						, FN_CNVR_NO(C.CASE_NO) AS CASE_NO --사건번호
						, TO_CHAR(A.EXCUT_DT, 'YYYY-MM-DD HH24:MI') || ' / ' || FN_CD_NM(A.REQST_RESULT_CD) AS REQST_RESULT_NM --처리일자 및 처리결과
						, TO_CHAR(TO_DATE(A.ISUE_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS ISUE_DE --처리결과를 통보받은 일자
						, TO_CHAR(A.EXCUT_DT, 'YYYY-MM-DD HH24:MI') AS EXCUT_DT --통지일자
						, '' AS BIGO --비고
					FROM INV_COMMN_PRMISN A
						LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
						LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
						LEFT JOIN CMN_USER UR ON C.CHARGER_ID = UR.ESNTL_ID
					WHERE A.USE_YN = 'Y'

					<isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	 </select>
	 
	 <!-- 
	 	2021.10.18
		coded by dgkim
		통신사실 확인자료제공 요청 집행사실 통지유예 승인신청부
		신규 문서 서식
	  -->
	 <select id="selectVdecRequstPostpneConfmList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT X.*
		FROM (
			SELECT A.*,	
				COUNT(*) OVER() AS TOT_CNT,			
				<isNotEmpty property="dataField">
					<isNotEmpty property="sortType">
						DENSE_RANK() OVER (ORDER BY A.$dataField$ $sortType$ NULLS LAST, A.PRMISN_PROGRS_NO) RN
					</isNotEmpty>
				</isNotEmpty>
				<isEmpty property="dataField">		
					DENSE_RANK() OVER (ORDER BY A.PRMISN_PROGRS_NO) AS RN
				</isEmpty> 				
			FROM
				(
					SELECT
						C.RC_NO --접수번호
						, TO_CHAR(TO_DATE(A.REQST_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS REQST_DE --신청일자
						, FN_CD_NM(UR.CLSF_CD) || ' / ' || FN_USER_NM(C.CHARGER_ID) AS CHARGER_NM --신청자의 직급 및 성명
						, FN_CNVR_NO(A.PRMISN_PROGRS_NO) AS PRMISN_PROGRS_NO --허가서 번호
						, B.TRGTER_NM --통지 대상자 성명
						, FN_CNVR_NO(C.CASE_NO) AS CASE_NO --사건번호
						, TO_CHAR(A.EXCUT_DT, 'YYYY-MM-DD HH24:MI') || ' / ' || FN_CD_NM(A.REQST_RESULT_CD) AS REQST_RESULT_NM --처리일자 및 처리결과
						, TO_CHAR(TO_DATE(A.ISUE_DE, 'YYYYMMDD'), 'YYYY-MM-DD') AS ISUE_DE --통보받은 일자
						, TO_CHAR(A.EXCUT_DT, 'YYYY-MM-DD HH24:MI') AS EXCUT_DT --승인일자
						--유예사유 해소 후 통지일자
					FROM INV_COMMN_PRMISN A
						LEFT JOIN RC_TMPR_TRGTER B ON A.RC_NO = B.RC_NO AND A.TRGTER_SN = B.TRGTER_SN
						LEFT JOIN RC_TMPR C ON A.RC_NO = C.RC_NO
						LEFT JOIN CMN_USER UR ON C.CHARGER_ID = UR.ESNTL_ID
					WHERE A.USE_YN = 'Y'

					<isNotEmpty property="trgter_nm" >
						AND B.TRGTER_NM = #trgter_nm#
					</isNotEmpty>
					<isNotEmpty property="chager" >
						AND C.CHARGER_ID = #chager#
					</isNotEmpty>
					<isNotEmpty property="dept_cd" >
						AND C.CHARGER_DEPT_CD IN (
							SELECT DC.DEPT_CD
							FROM CMN_DEPT_CD DC
							WHERE DC.USE_YN = 'Y' AND DC.DEPT_CD != '00000'
							START WITH DC.DEPT_CD = #dept_cd#
							CONNECT BY PRIOR DC.DEPT_CD = DC.DEPT_UPPER_CD
						)
					</isNotEmpty>
			) A
		) X
		<isNotEmpty property="startRow" >
			WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		</isNotEmpty>
		ORDER BY RN ASC
	 </select>
	 
	 <!-- 
	 	2022.02.09
	 	coded by dgkim
	 	사건대장 출력이력 저장
	 	대검 범죄사건부 보안 조치
	  -->
	 <insert id="insertStatsOutptHist" parameterClass="java.util.HashMap">
		INSERT INTO CMN_STATS_OUTPT_HIST 
			(
				OUTPT_DT
				, ESNTL_ID
				, OUTPT_URL
				, OUTPT_IP
			) 
		VALUES
			(
				SYSDATE
				, #esntl_id#
				, #outpt_url#
				, #outpt_ip#
			)
	</insert>
	
	<!-- 
		2022.02.09
		coded by dgkim
		사건대장 출력이력 조회
		대검 범죄사건부 보안 조치
	 -->
	<select id="selectStatsOutptHistList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
			X.*
		FROM
		(
			SELECT A.*,
				ROWNUM AS RN, COUNT(*) OVER() AS TOT_CNT
			FROM
			(
				SELECT 
					TO_CHAR(OUTPT_DT, 'YYYY-MM-DD HH24:MI:ss') AS OUTPT_DT --출력시간
					, ESNTL_ID --출력자 ID
					, OUTPT_URL --출력 관련 메뉴
					, OUTPT_IP --출력자 IP
					, (SELECT USER_ID FROM CMN_USER WHERE ESNTL_ID = csoh.ESNTL_ID) AS USER_ID --사용자 ID 
					, (SELECT USER_NM FROM CMN_USER WHERE ESNTL_ID = csoh.ESNTL_ID) AS USER_NM --사용자 명
					, (
						SELECT 
							cmc.MENU_CL_NM || ' > ' || cmd.MENU_NM
						FROM CMN_MENU_CL cmc
							, CMN_MENU_DETAIL cmd
							, CMN_MENU_RELATE_URL cmru
						WHERE
							cmc.MENU_CL_CD = cmd.MENU_CL_CD 
							AND cmd.MENU_CD = cmru.MENU_CD
							AND cmru.RELATE_URL = csoh.OUTPT_URL
					) AS MENU_NM --출력 경로 메뉴명
				FROM CMN_STATS_OUTPT_HIST csoh
				WHERE csoh.OUTPT_IP NOT IN('127.0.0.1', '0:0:0:0:0:0:0:1', '10.66.204.45') --테스트 IP 제외
					
					<isNotEmpty property="searchUserID" prepend="AND">
						csoh.ESNTL_ID IN(SELECT ESNTL_ID FROM CMN_USER WHERE USER_ID LIKE '%' || #searchUserID# || '%')
					</isNotEmpty>
					
					<isNotEmpty property="searchUserNm" prepend="AND">
						csoh.ESNTL_ID IN(SELECT ESNTL_ID FROM CMN_USER WHERE USER_NM LIKE '%' || #searchUserNm# || '%')
					</isNotEmpty>
					
					<isNotEmpty property="searchIp" prepend="AND">
						 csoh.OUTPT_IP LIKE '%' || #searchIp# || '%'
					</isNotEmpty>
					
					<isNotEmpty property="searchDe1">
						<isNotEmpty property="searchDe2" prepend="AND" >
							csoh.OUTPT_DT BETWEEN TO_DATE(#searchDe1# || '00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#searchDe2# || '23:59:59', 'YYYY-MM-DD HH24:MI:SS')
						</isNotEmpty>
					</isNotEmpty>
				
				ORDER BY csoh.OUTPT_DT DESC
			) A
		) X
		WHERE (RN <![CDATA[ > ]]> #startRow# AND RN <![CDATA[ <= ]]> #endRow#)
		ORDER BY RN ASC
	 </select>
</sqlMap>